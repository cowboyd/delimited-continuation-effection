# delimited-continuation-effection

Effection v3 uses [delimited continuations](https://en.wikipedia.org/wiki/Delimited_continuation) as the core primitive. However, it does so with [separate library](https://github.com/thefrontside/continuation/) and so there are two layers of generators (stackless coroutines): The coroutines that represent Effection operations and the coroutines based on delimited continuations that manage those Effection co-routines. As a result, for a single Effection routine, there could be N co-routines added on to manage it. In addition to that, there is a reduction stack per Effection frame. Not only does this mean that ordering of instructions has to be explicitly managed between related frames (with more co-routines), but also it has memory implications.

This proof of concept brings delimited continuations directly into Effection by implementing `shift()` and `reset()` as operations. There is a single stack per entry point, so the ordering of operations in related scopes is implicit. Furthermore, every Effection reduction is just a single while loop thunking on that shared stack, so it should be far more efficient in both space and time.
